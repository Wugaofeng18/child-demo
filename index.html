<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é­”æ³•è¯†å­—ä¹å›­ - å„¿ç«¥è¯†å­—å›¾ç‰‡ç”Ÿæˆç½‘ç«™</title>

    <!-- Preconnect to fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

    <!-- Disney-style fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Bubblegum+Sans&family=Comic+Neue:wght@700&family=Noto+Sans+SC:wght@400;700&display=swap" rel="stylesheet">

    <!-- CSS -->
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/components.css">

    <!-- Additional styles for GitHub Pages compatibility -->
    <style>
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes slideOut {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(100%);
                opacity: 0;
            }
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        @keyframes wiggle {
            0%, 100% { transform: rotate(-3deg); }
            50% { transform: rotate(3deg); }
        }

        @keyframes sparkle {
            0%, 100% { opacity: 0; transform: scale(0); }
            50% { opacity: 1; transform: scale(1); }
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        @keyframes shimmer {
            0% { background-position: -200px 0; }
            100% { background-position: calc(200px + 100%) 0; }
        }
    </style>

    <!-- Icons -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='0.9em' font-size='90'>ğŸ°</text></svg>">
</head>
<body>
    <!-- Loading Screen -->
    <div id="loadingScreen" class="loading-screen">
        <div class="castle-loader">
            <div class="castle">ğŸ°</div>
            <div class="stars">
                <span class="star">âœ¨</span>
                <span class="star">â­</span>
                <span class="star">âœ¨</span>
            </div>
            <p class="loading-text">é­”æ³•åŠ è½½ä¸­...</p>
        </div>
    </div>

    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <span class="logo-icon">ğŸ°</span>
                    <h1 class="logo-text">é­”æ³•è¯†å­—ä¹å›­</h1>
                    <span class="logo-subtitle">è®©å­¦ä¹ å……æ»¡é­”æ³•</span>
                </div>
                <nav class="nav">
                    <button class="nav-btn active" data-page="generate">
                        <span class="btn-icon">âœ¨</span>
                        <span>ç”Ÿæˆå›¾ç‰‡</span>
                    </button>
                    <button class="nav-btn" data-page="history">
                        <span class="btn-icon">ğŸ“š</span>
                        <span>å†å²è®°å½•</span>
                    </button>
                    <button class="nav-btn" data-page="about">
                        <span class="btn-icon">â„¹ï¸</span>
                        <span>å…³äºæˆ‘ä»¬</span>
                    </button>
                </nav>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main">
        <!-- Generate Page -->
        <section id="generatePage" class="page active">
            <div class="container">
                <div class="page-header">
                    <h2 class="page-title">
                        <span class="title-icon">ğŸ¨</span>
                        åˆ›å»ºä½ çš„è¯†å­—å›¾ç‰‡
                    </h2>
                    <p class="page-subtitle">é€‰æ‹©ä¸€ä¸ªä¸»é¢˜ï¼Œè¾“å…¥æ ‡é¢˜ï¼Œè®©AIä¸ºä½ åˆ›é€ ç¥å¥‡çš„è¯†å­—å›¾ç‰‡ï¼</p>
                </div>

                <div class="generate-form">
                    <!-- Theme Selection -->
                    <div class="form-section">
                        <label class="form-label">
                            <span class="label-icon">ğŸŒˆ</span>
                            é€‰æ‹©ä¸»é¢˜åœºæ™¯
                        </label>
                        <div class="theme-grid" id="themeGrid">
                            <!-- Themes will be dynamically added here -->
                        </div>
                    </div>

                    <!-- Title Input -->
                    <div class="form-section">
                        <label class="form-label" for="titleInput">
                            <span class="label-icon">âœï¸</span>
                            å°æŠ¥æ ‡é¢˜
                        </label>
                        <div class="input-wrapper">
                            <input
                                type="text"
                                id="titleInput"
                                class="magic-input"
                                placeholder="ç»™ä½ çš„è¯†å­—å›¾ç‰‡èµ·ä¸ªå¥½å¬çš„åå­—..."
                                maxlength="30"
                            >
                            <span class="input-counter" id="titleCounter">0/30</span>
                        </div>
                        <div class="input-suggestions">
                            <span class="suggestion-label">çµæ„Ÿæç¤ºï¼š</span>
                            <button class="suggestion-btn" data-suggestion="å¿«ä¹è¶…å¸‚è´­ç‰©">å¿«ä¹è¶…å¸‚è´­ç‰©</button>
                            <button class="suggestion-btn" data-suggestion="ç¥å¥‡çš„åŒ»é™¢">ç¥å¥‡çš„åŒ»é™¢</button>
                            <button class="suggestion-btn" data-suggestion="å…¬å›­é‡Œçš„æ¬¢ä¹æ—¶å…‰">å…¬å›­é‡Œçš„æ¬¢ä¹æ—¶å…‰</button>
                        </div>
                    </div>

                    <!-- API Key Input -->
                    <div class="form-section">
                        <label class="form-label" for="apiKeyInput">
                            <span class="label-icon">ğŸ”‘</span>
                            API å¯†é’¥
                        </label>
                        <div class="input-wrapper">
                            <input
                                type="password"
                                id="apiKeyInput"
                                class="magic-input"
                                placeholder="è¾“å…¥ä½ çš„ Nano Banana Pro API å¯†é’¥"
                            >
                            <button class="toggle-visibility" id="toggleApiKey">
                                <span class="eye-icon">ğŸ‘ï¸</span>
                            </button>
                        </div>
                        <p class="form-hint">
                            ğŸ“ APIå¯†é’¥ç”¨äºç”Ÿæˆå›¾ç‰‡ï¼Œè¯·è®¿é—® <a href="https://kie.ai/api-key" target="_blank">KIE AI</a> è·å–
                        </p>
                    </div>

                    <!-- Generate Button -->
                    <div class="form-section">
                        <button id="generateBtn" class="magic-btn generate-btn" disabled>
                            <span class="btn-content">
                                <span class="btn-icon">ğŸª„</span>
                                <span class="btn-text">å¼€å§‹ç”Ÿæˆé­”æ³•å›¾ç‰‡</span>
                            </span>
                            <div class="sparkles">
                                <span class="sparkle">âœ¨</span>
                                <span class="sparkle">â­</span>
                                <span class="sparkle">âœ¨</span>
                            </div>
                        </button>
                    </div>
                </div>

                <!-- Result Section -->
                <div id="resultSection" class="result-section hidden">
                    <h3 class="result-title">
                        <span class="title-icon">ğŸ‰</span>
                        ä½ çš„é­”æ³•å›¾ç‰‡å®Œæˆå•¦ï¼
                    </h3>
                    <div class="result-content">
                        <div class="image-container">
                            <img id="resultImage" alt="ç”Ÿæˆçš„è¯†å­—å›¾ç‰‡" class="result-image" onerror="handleImageError(this)">
                            <div class="image-overlay">
                                <button class="overlay-btn" id="downloadBtn">
                                    <span class="btn-icon">ğŸ’¾</span>
                                    <span>ä¸‹è½½å›¾ç‰‡</span>
                                </button>
                                <button class="overlay-btn" id="saveHistoryBtn">
                                    <span class="btn-icon">ğŸ’</span>
                                    <span>æŸ¥çœ‹è¯¦æƒ…</span>
                                </button>
                            </div>
                        </div>
                    </div>
                    <button class="secondary-btn" id="generateAnotherBtn">
                        <span class="btn-icon">ğŸ”„</span>
                        <span>å†ç”Ÿæˆä¸€å¼ </span>
                    </button>
                </div>
            </div>
        </section>

        <!-- History Page -->
        <section id="historyPage" class="page">
            <div class="container">
                <div class="page-header">
                    <h2 class="page-title">
                        <span class="title-icon">ğŸ“š</span>
                        æˆ‘çš„è¯†å­—å›¾ç‰‡é›†
                    </h2>
                    <p class="page-subtitle">æŸ¥çœ‹å’Œä¸‹è½½ä½ ä¹‹å‰ç”Ÿæˆçš„æ‰€æœ‰è¯†å­—å›¾ç‰‡</p>
                </div>

                <div class="history-controls">
                    <button class="secondary-btn" id="clearHistoryBtn">
                        <span class="btn-icon">ğŸ—‘ï¸</span>
                        <span>æ¸…ç©ºå†å²</span>
                    </button>
                    <button class="secondary-btn" id="exportHistoryBtn">
                        <span class="btn-icon">ğŸ“¤</span>
                        <span>å¯¼å‡ºè®°å½•</span>
                    </button>
                </div>

                <div id="historyGrid" class="history-grid">
                    <!-- History items will be dynamically added here -->
                </div>

                <div id="emptyHistory" class="empty-state">
                    <div class="empty-icon">ğŸ“</div>
                    <h3>è¿˜æ²¡æœ‰è¯†å­—å›¾ç‰‡</h3>
                    <p>å¿«å»ç”Ÿæˆä½ çš„ç¬¬ä¸€å¼ é­”æ³•å›¾ç‰‡å§ï¼</p>
                    <button class="magic-btn" onclick="switchPage('generate')">
                        <span class="btn-icon">âœ¨</span>
                        <span>å¼€å§‹ç”Ÿæˆ</span>
                    </button>
                </div>
            </div>
        </section>

        <!-- About Page -->
        <section id="aboutPage" class="page">
            <div class="container">
                <div class="page-header">
                    <h2 class="page-title">
                        <span class="title-icon">â„¹ï¸</span>
                        å…³äºé­”æ³•è¯†å­—ä¹å›­
                    </h2>
                </div>

                <div class="about-content">
                    <div class="about-card">
                        <h3>
                            <span class="card-icon">ğŸ¯</span>
                            æˆ‘ä»¬çš„ä½¿å‘½
                        </h3>
                        <p>é€šè¿‡AIæŠ€æœ¯å’Œåˆ›æ„è®¾è®¡ï¼Œä¸º5-9å²å„¿ç«¥åˆ›é€ æœ‰è¶£ã€æœ‰æ•ˆçš„ä¸­æ–‡å­¦ä¹ ä½“éªŒã€‚æ¯ä¸ªæ±‰å­—éƒ½é€šè¿‡ç”ŸåŠ¨çš„åœºæ™¯å›¾ç‰‡æ¥å‘ˆç°ï¼Œè®©å­¦ä¹ å˜å¾—åƒç©æ¸¸æˆä¸€æ ·å¿«ä¹ï¼</p>
                    </div>

                    <div class="about-card">
                        <h3>
                            <span class="card-icon">âœ¨</span>
                            ç‰¹è‰²åŠŸèƒ½
                        </h3>
                        <ul>
                            <li>ğŸ¨ è¿ªå£«å°¼é£æ ¼çš„ç²¾ç¾ç•Œé¢è®¾è®¡</li>
                            <li>ğŸ¤– åŸºäºNano Banana Proçš„AIå›¾ç‰‡ç”Ÿæˆ</li>
                            <li>ğŸ“š ä¸°å¯Œçš„ä¸»é¢˜åœºæ™¯è¯æ±‡åº“</li>
                            <li>ğŸ’¾ æœ¬åœ°å†å²è®°å½•ä¿å­˜</li>
                            <li>ğŸ“± å®Œå…¨å“åº”å¼è®¾è®¡</li>
                        </ul>
                    </div>

                    <div class="about-card">
                        <h3>
                            <span class="card-icon">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦</span>
                            é€‚ç”¨å¹´é¾„
                        </h3>
                        <p>ä¸“ä¸º5-9å²å„¿ç«¥è®¾è®¡ï¼Œå†…å®¹éš¾åº¦å¾ªåºæ¸è¿›ï¼Œç¬¦åˆå„¿ç«¥è®¤çŸ¥å‘å±•è§„å¾‹ã€‚</p>
                    </div>

                    <div class="about-card">
                        <h3>
                            <span class="card-icon">ğŸ›¡ï¸</span>
                            éšç§ä¿æŠ¤
                        </h3>
                        <p>æˆ‘ä»¬éå¸¸é‡è§†å„¿ç«¥éšç§ä¿æŠ¤ã€‚æ‰€æœ‰æ•°æ®ä»…å­˜å‚¨åœ¨æœ¬åœ°ï¼Œä¸ä¼šä¸Šä¼ åˆ°ä»»ä½•æœåŠ¡å™¨ã€‚</p>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <p class="footer-text">
                <span>â¤ï¸ ç”¨çˆ±åˆ¶ä½œï¼Œä¸ºå­©å­ä»¬åˆ›é€ æ›´å¥½çš„å­¦ä¹ ä½“éªŒ</span>
                <span class="separator">|</span>
                <span>Â© 2024 é­”æ³•è¯†å­—ä¹å›­</span>
            </p>
        </div>
    </footer>

    <!-- Modals -->
    <div id="modalContainer" class="modal-container hidden">
        <!-- Modals will be dynamically added here -->
    </div>

    <!-- Toast Notifications -->
    <div id="toastContainer" class="toast-container">
        <!-- Toast messages will be dynamically added here -->
    </div>

    <!-- JavaScript -->
    <script>
        // æœ€ç®€åŒ–ç‰ˆæœ¬ - ç¡®ä¿é¡µé¢èƒ½æ­£å¸¸åŠ è½½
        console.log('ğŸ° å¯åŠ¨é­”æ³•è¯†å­—ä¹å›­...');

        // ç«‹å³éšè—åŠ è½½å±å¹•
        setTimeout(() => {
            const loadingScreen = document.getElementById('loadingScreen');
            if (loadingScreen) {
                loadingScreen.style.display = 'none';
            }
        }, 1000);

        // å…¨å±€æ•°æ®
        window.appData = {
            selectedTheme: null,
            currentResult: null,
            isGenerating: false,
            themesData: {
                "supermarket": {
                    "name": "è¶…å¸‚", "icon": "ğŸ›’",
                    "vocabulary": {"core": [
                        {"chinese": "æ”¶é“¶å‘˜", "pinyin": "shÅu yÃ­n yuÃ¡n"},
                        {"chinese": "è´§æ¶", "pinyin": "huÃ² jiÃ "},
                        {"chinese": "è´­ç‰©è½¦", "pinyin": "gÃ²u wÃ¹ chÄ“"},
                        {"chinese": "æ”¶é“¶å°", "pinyin": "shÅu yÃ­n tÃ¡i"},
                        {"chinese": "è‹¹æœ", "pinyin": "pÃ­ng guÇ’"},
                        {"chinese": "ç‰›å¥¶", "pinyin": "niÃº nÇi"},
                        {"chinese": "é¢åŒ…", "pinyin": "miÃ n bÄo"}
                    ]}
                },
                "park": {
                    "name": "å…¬å›­", "icon": "ğŸŒ³",
                    "vocabulary": {"core": [
                        {"chinese": "å¤§æ ‘", "pinyin": "dÃ  shÃ¹"},
                        {"chinese": "è‰åœ°", "pinyin": "cÇo dÃ¬"},
                        {"chinese": "é•¿æ¤…", "pinyin": "chÃ¡ng yÇ"},
                        {"chinese": "ç§‹åƒ", "pinyin": "qiÅ« qiÄn"},
                        {"chinese": "æ»‘æ¢¯", "pinyin": "huÃ¡ tÄ«"},
                        {"chinese": "èŠ±æœµ", "pinyin": "huÄ duÇ’"},
                        {"chinese": "å°è·¯", "pinyin": "xiÇo lÃ¹"}
                    ]}
                },
                "zoo": {
                    "name": "åŠ¨ç‰©å›­", "icon": "ğŸ¦",
                    "vocabulary": {"core": [
                        {"chinese": "ç‹®å­", "pinyin": "shÄ« zi"},
                        {"chinese": "å¤§è±¡", "pinyin": "dÃ  xiÃ ng"},
                        {"chinese": "çŒ´å­", "pinyin": "hÃ³u zi"},
                        {"chinese": "ç†ŠçŒ«", "pinyin": "xiÃ³ng mÄo"},
                        {"chinese": "è€è™", "pinyin": "lÇo hÇ”"},
                        {"chinese": "é•¿é¢ˆé¹¿", "pinyin": "chÃ¡ng jÇng lÃ¹"},
                        {"chinese": "æ–‘é©¬", "pinyin": "bÄn mÇ"}
                    ]}
                },
                "school": {
                    "name": "å­¦æ ¡", "icon": "ğŸ«",
                    "vocabulary": {"core": [
                        {"chinese": "è€å¸ˆ", "pinyin": "lÇo shÄ«"},
                        {"chinese": "å­¦ç”Ÿ", "pinyin": "xuÃ© shÄ“ng"},
                        {"chinese": "æ•™å®¤", "pinyin": "jiÃ o shÃ¬"},
                        {"chinese": "è¯¾æ¡Œ", "pinyin": "kÃ¨ zhuÅ"},
                        {"chinese": "é»‘æ¿", "pinyin": "hÄ“i bÇn"},
                        {"chinese": "é“…ç¬”", "pinyin": "qiÄn bÇ"},
                        {"chinese": "ä¹¦æœ¬", "pinyin": "shÅ« bÄ›n"}
                    ]}
                },
                "hospital": {
                    "name": "åŒ»é™¢", "icon": "ğŸ¥",
                    "vocabulary": {"core": [
                        {"chinese": "åŒ»ç”Ÿ", "pinyin": "yÄ« shÄ“ng"},
                        {"chinese": "æŠ¤å£«", "pinyin": "hÃ¹ shi"},
                        {"chinese": "ç—…äºº", "pinyin": "bÃ¬ng rÃ©n"},
                        {"chinese": "ç—…åºŠ", "pinyin": "bÃ¬ng chuÃ¡ng"},
                        {"chinese": "å¬è¯Šå™¨", "pinyin": "tÄ«ng zhÄ›n qÃ¬"},
                        {"chinese": "è¯ç‰‡", "pinyin": "yÃ o piÃ n"},
                        {"chinese": "ä½“æ¸©è®¡", "pinyin": "tÇ wÄ“n jÃ¬"}
                    ]}
                },
                "home": {
                    "name": "å®¶åº­", "icon": "ğŸ ",
                    "vocabulary": {"core": [
                        {"chinese": "çˆ¸çˆ¸", "pinyin": "bÃ  ba"},
                        {"chinese": "å¦ˆå¦ˆ", "pinyin": "mÄ ma"},
                        {"chinese": "å­©å­", "pinyin": "hÃ¡i zi"},
                        {"chinese": "æ¡Œå­", "pinyin": "zhuÅ zi"},
                        {"chinese": "æ¤…å­", "pinyin": "yÇ zi"},
                        {"chinese": "æ²™å‘", "pinyin": "shÄ fÄ"},
                        {"chinese": "ç”µè§†", "pinyin": "diÃ n shÃ¬"}
                    ]}
                },
                "restaurant": {
                    "name": "é¤å…", "icon": "ğŸ´",
                    "vocabulary": {"core": [
                        {"chinese": "æœåŠ¡å‘˜", "pinyin": "fÃº wÃ¹ yuÃ¡n"},
                        {"chinese": "èœå•", "pinyin": "cÃ i dÄn"},
                        {"chinese": "é¤æ¡Œ", "pinyin": "cÄn zhuÅ"},
                        {"chinese": "ç±³é¥­", "pinyin": "mÇ fÃ n"},
                        {"chinese": "é¢æ¡", "pinyin": "miÃ n tiÃ¡o"},
                        {"chinese": "é¥ºå­", "pinyin": "jiÇo zi"},
                        {"chinese": "ç­·å­", "pinyin": "kuÃ i zi"}
                    ]}
                },
                "playground": {
                    "name": "æ¸¸ä¹åœº", "icon": "ğŸ ",
                    "vocabulary": {"core": [
                        {"chinese": "æ—‹è½¬æœ¨é©¬", "pinyin": "xuÃ¡n zhuÇn mÃ¹ mÇ"},
                        {"chinese": "æ‘©å¤©è½®", "pinyin": "mÃ³ tiÄn lÃºn"},
                        {"chinese": "è¿‡å±±è½¦", "pinyin": "guÃ² shÄn chÄ“"},
                        {"chinese": "ç¢°ç¢°è½¦", "pinyin": "pÃ¨ng pÃ¨ng chÄ“"},
                        {"chinese": "è··è··æ¿", "pinyin": "qiÄo qiÄo bÇn"},
                        {"chinese": "æ²™å‘", "pinyin": "shÄ kÄ“ng"},
                        {"chinese": "å°ç«è½¦", "pinyin": "xiÇo huÇ’ chÄ“"}
                    ]}
                },
                "farm": {
                    "name": "å†œåœº", "icon": "ğŸšœ",
                    "vocabulary": {"core": [
                        {"chinese": "å†œæ°‘", "pinyin": "nÃ³ng mÃ­n"},
                        {"chinese": "ç¨»ç”°", "pinyin": "dÃ o tiÃ¡n"},
                        {"chinese": "æ‹–æ‹‰æœº", "pinyin": "tuÅ lÄ jÄ«"},
                        {"chinese": "å°é¸¡", "pinyin": "xiÇo jÄ«"},
                        {"chinese": "å°é¸­", "pinyin": "xiÇo yÄ"},
                        {"chinese": "å°çŒª", "pinyin": "xiÇo zhÅ«"},
                        {"chinese": "ç¨»è‰äºº", "pinyin": "dÃ o cÇo rÃ©n"}
                    ]}
                },
                "beach": {
                    "name": "æµ·æ»©", "icon": "ğŸ–ï¸",
                    "vocabulary": {"core": [
                        {"chinese": "æ²™æ»©", "pinyin": "shÄ tÄn"},
                        {"chinese": "æµ·æµª", "pinyin": "hÇi lÃ ng"},
                        {"chinese": "è´å£³", "pinyin": "bÃ¨i kÃ©"},
                        {"chinese": "èƒèŸ¹", "pinyin": "pÃ¡ng xiÃ¨"},
                        {"chinese": "æµ·æ˜Ÿ", "pinyin": "hÇi xÄ«ng"},
                        {"chinese": "æ•‘ç”Ÿåœˆ", "pinyin": "jiÃ¹ shÄ“ng quÄn"},
                        {"chinese": "é®é˜³ä¼", "pinyin": "zhÄ“ yÃ¡ng sÇn"}
                    ]}
                },
                "space": {
                    "name": "å¤ªç©º", "icon": "ğŸš€",
                    "vocabulary": {"core": [
                        {"chinese": "å®‡èˆªå‘˜", "pinyin": "yÇ” hÃ¡ng yuÃ¡n"},
                        {"chinese": "ç«ç®­", "pinyin": "huÇ’ jiÃ n"},
                        {"chinese": "åœ°çƒ", "pinyin": "dÃ¬ qiÃº"},
                        {"chinese": "æœˆäº®", "pinyin": "yuÃ¨ liang"},
                        {"chinese": "æ˜Ÿæ˜Ÿ", "pinyin": "xÄ«ng xing"},
                        {"chinese": "å¤ªç©ºèˆ¹", "pinyin": "tÃ i kÅng chuÃ¡n"},
                        {"chinese": "å«æ˜Ÿ", "pinyin": "wÃ¨i xÄ«ng"}
                    ]}
                },
                "underwater": {
                    "name": "æµ·åº•ä¸–ç•Œ", "icon": "ğŸ ",
                    "vocabulary": {"core": [
                        {"chinese": "æ½œæ°´å‘˜", "pinyin": "qiÃ¡n shuÇ yuÃ¡n"},
                        {"chinese": "çŠç‘š", "pinyin": "shÄn hÃº"},
                        {"chinese": "æµ·è‰", "pinyin": "hÇi cÇo"},
                        {"chinese": "çƒ­å¸¦é±¼", "pinyin": "rÃ¨ dÃ i yÃº"},
                        {"chinese": "æµ·é¾Ÿ", "pinyin": "hÇi guÄ«"},
                        {"chinese": "ç« é±¼", "pinyin": "zhÄng yÃº"},
                        {"chinese": "æ°´æ¯", "pinyin": "shuÇ mÇ”"}
                    ]}
                }
            }
        };

        // æ¢å¤ç”¨æˆ·è¾“å…¥ï¼ˆåœ¨é¡µé¢åŠ è½½æ—¶ï¼‰
        function restoreUserInput() {
            try {
                const savedTitle = localStorage.getItem('literacy_user_title');
                const savedApiKey = localStorage.getItem('literacy_user_api_key');
                const savedTheme = localStorage.getItem('literacy_user_theme');

                if (savedTitle) {
                    const titleInput = document.getElementById('titleInput');
                    if (titleInput) {
                        titleInput.value = savedTitle;
                        console.log('Restored title input');
                    }
                }

                if (savedApiKey) {
                    const apiKeyInput = document.getElementById('apiKeyInput');
                    if (apiKeyInput) {
                        apiKeyInput.value = savedApiKey;
                        console.log('Restored API key input');
                    }
                }

                if (savedTheme && window.appData.themesData[savedTheme]) {
                    window.appData.selectedTheme = savedTheme;
                    // å»¶è¿Ÿæ›´æ–°UIé€‰æ‹©çŠ¶æ€ï¼Œç¡®ä¿DOMå·²åŠ è½½
                    setTimeout(() => {
                        updateThemeSelection();
                        console.log('Restored theme selection:', savedTheme);
                    }, 100);
                }
            } catch (error) {
                console.log('Failed to restore user input:', error);
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸ¨ å¼€å§‹åˆå§‹åŒ–...');
            initSimple();
        });

        function initSimple() {
            try {
                // æ¸²æŸ“ä¸»é¢˜
                renderSimpleThemes();

                // ç»‘å®šåŸºæœ¬äº‹ä»¶
                bindSimpleEvents();

                // æ¢å¤ç”¨æˆ·è¾“å…¥
                restoreUserInput();

                console.log('âœ… åˆå§‹åŒ–å®Œæˆ');
            } catch (error) {
                console.error('âŒ åˆå§‹åŒ–å¤±è´¥:', error);
            }
        }

        function renderSimpleThemes() {
            const themeGrid = document.getElementById('themeGrid');
            if (!themeGrid) return;

            themeGrid.innerHTML = '';
            Object.entries(window.appData.themesData).forEach(([key, theme]) => {
                const card = document.createElement('div');
                card.className = 'theme-card';
                card.dataset.theme = key;
                card.innerHTML = `<div class="theme-icon">${theme.icon}</div><div class="theme-name">${theme.name}</div>`;
                card.addEventListener('click', () => selectSimpleTheme(key));
                themeGrid.appendChild(card);
            });
        }

        function selectSimpleTheme(themeKey) {
            document.querySelectorAll('.theme-card').forEach(card => {
                card.classList.toggle('selected', card.dataset.theme === themeKey);
            });
            window.appData.selectedTheme = themeKey;
            validateSimpleForm();
        }

        function validateSimpleForm() {
            const title = document.getElementById('titleInput')?.value?.trim() || '';
            const apiKey = document.getElementById('apiKeyInput')?.value?.trim() || '';
            const isValid = window.appData.selectedTheme && title.length > 0 && apiKey.length > 0;

            const generateBtn = document.getElementById('generateBtn');
            if (generateBtn) {
                generateBtn.disabled = !isValid;
            }
        }

        function bindSimpleEvents() {
            // åŸºæœ¬è¾“å…¥äº‹ä»¶
            const titleInput = document.getElementById('titleInput');
            const apiKeyInput = document.getElementById('apiKeyInput');
            const generateBtn = document.getElementById('generateBtn');

            if (titleInput) titleInput.addEventListener('input', validateSimpleForm);
            if (apiKeyInput) apiKeyInput.addEventListener('input', validateSimpleForm);
            if (generateBtn) generateBtn.addEventListener('click', handleSimpleGenerate);

            // å¯¼èˆªäº‹ä»¶
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const page = btn.dataset.page;
                    switchSimplePage(page);
                });
            });
        }

        function switchSimplePage(page) {
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.page === page);
            });
            document.querySelectorAll('.page').forEach(pageElement => {
                pageElement.classList.toggle('active', pageElement.id === `${page}Page`);
            });

            // åŠ è½½å†å²è®°å½•
            if (page === 'history') {
                loadHistory();
            }
        }

        // åŠ è½½å†å²è®°å½•
        function loadHistory() {
            try {
                const history = JSON.parse(localStorage.getItem('literacy_history') || '[]');
                const historyGrid = document.getElementById('historyGrid');
                const emptyHistory = document.getElementById('emptyHistory');

                if (!historyGrid || !emptyHistory) return;

                if (history.length === 0) {
                    emptyHistory.style.display = 'block';
                    historyGrid.style.display = 'none';
                    return;
                }

                emptyHistory.style.display = 'none';
                historyGrid.style.display = 'grid';
                historyGrid.innerHTML = '';

                history.forEach(item => {
                    const historyItem = document.createElement('div');
                    historyItem.className = 'history-item';
                    historyItem.style.cssText = `
                        background: white;
                        border: 1px solid #ddd;
                        border-radius: 10px;
                        padding: 15px;
                        margin-bottom: 15px;
                        cursor: pointer;
                        transition: all 0.3s ease;
                    `;

                    historyItem.innerHTML = `
                        <img src="${item.imageUrl}" alt="${item.title}" style="max-width: 100%; border-radius: 5px;">
                        <div style="margin-top: 10px;">
                            <h4 style="margin: 0; color: #333;">${item.title}</h4>
                            <p style="margin: 0; color: #666; font-size: 14px;">${new Date(item.timestamp).toLocaleString('zh-CN')}</p>
                        </div>
                    `;

                    historyItem.addEventListener('click', () => {
                        showHistoryItemModal(item);
                    });

                    historyGrid.appendChild(historyItem);
                });
            } catch (error) {
                console.error('åŠ è½½å†å²è®°å½•å¤±è´¥:', error);
            }
        }

        // æ˜¾ç¤ºå†å²è®°å½•æ¨¡æ€æ¡†
        function showHistoryItemModal(item) {
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0,0,0,0.5);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 1000;
            `;

            modal.innerHTML = `
                <div style="
                    background: white;
                    border-radius: 15px;
                    padding: 30px;
                    max-width: 90%;
                    max-height: 90%;
                    overflow: auto;
                    position: relative;
                ">
                    <button onclick="this.closest('.modal').remove()" style="
                        position: absolute;
                        top: 10px;
                        right: 10px;
                        background: none;
                        border: none;
                        font-size: 20px;
                        cursor: pointer;
                    ">âŒ</button>
                    <h3 style="color: #9B59B6; margin-bottom: 20px;">${item.title}</h3>
                    <div style="text-align: center;">
                        <img src="${item.imageUrl}" alt="${item.title}" style="max-width: 100%; max-height: 500px; border-radius: 10px; margin-bottom: 20px;">
                        <p><strong>ä¸»é¢˜ï¼š</strong>${item.themeName || item.theme}</p>
                        <p><strong>ç”Ÿæˆæ—¶é—´ï¼š</strong>${new Date(item.timestamp).toLocaleString('zh-CN')}</p>
                    </div>
                    <div style="display: flex; gap: 15px; margin-top: 20px; justify-content: center;">
                        <button onclick="downloadImage('${item.imageUrl}', 'è¯†å­—å›¾ç‰‡_${item.title}_${item.timestamp}.png')" style="
                            background: linear-gradient(135deg, #4a90e2, #ff6b9d);
                            color: white;
                            border: none;
                            padding: 12px 24px;
                            border-radius: 8px;
                            cursor: pointer;
                            font-weight: bold;
                        ">ğŸ’¾ ä¸‹è½½å›¾ç‰‡</button>
                    </div>
                </div>
            `;

            document.body.appendChild(modal);

            // ç‚¹å‡»èƒŒæ™¯å…³é—­
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.remove();
                }
            });
        }

        // åˆ›å»ºä¸‹è½½æ¨¡æ€æ¡†ï¼ˆè§£å†³GitHub Pages CORSé—®é¢˜ï¼‰
        function createDownloadModal(imageUrl, title) {
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0,0,0,0.8);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 2000;
            `;

            modal.innerHTML = `
                <div style="
                    background: white;
                    border-radius: 15px;
                    padding: 30px;
                    max-width: 500px;
                    width: 90%;
                    position: relative;
                ">
                    <h3 style="color: #9B59B6; margin-bottom: 20px; text-align: center;">ğŸ’¾ ä¸‹è½½è¯†å­—å›¾ç‰‡</h3>

                    <div style="margin-bottom: 20px; text-align: center;">
                        <img src="${imageUrl}" alt="ç”Ÿæˆçš„è¯†å­—å›¾ç‰‡" style="max-width: 100%; max-height: 300px; border-radius: 10px; margin-bottom: 15px;">
                        <p style="color: #666; font-size: 14px; margin: 10px 0;">
                            <strong>æ ‡é¢˜ï¼š</strong>${title}
                        </p>
                    </div>

                    <div style="margin-bottom: 20px; background: #f8f9fa; padding: 15px; border-radius: 8px;">
                        <h4 style="margin: 0 0 10px 0; color: #333;">ğŸ“¥ ä¸‹è½½æ–¹å¼ï¼š</h4>

                        <div style="margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 5px; font-weight: bold; color: #555;">ğŸ”— å¤åˆ¶é“¾æ¥ï¼š</label>
                            <div style="display: flex; gap: 10px;">
                                <input type="text" value="${imageUrl}" readonly style="
                                    flex: 1;
                                    padding: 8px;
                                    border: 1px solid #ddd;
                                    border-radius: 5px;
                                    font-size: 12px;
                                    font-family: monospace;
                                    background: white;
                                " onclick="this.select()">
                                <button onclick="copyToClipboard('${imageUrl}')" style="
                                    padding: 8px 15px;
                                    background: #4CAF50;
                                    color: white;
                                    border: none;
                                    border-radius: 5px;
                                    cursor: pointer;
                                ">ğŸ“‹ å¤åˆ¶</button>
                            </div>
                        </div>

                        <div style="margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 5px; font-weight: bold; color: #555;">ğŸŒ åœ¨æ–°æ ‡ç­¾é¡µæ‰“å¼€ï¼š</label>
                            <button onclick="window.open('${imageUrl}', '_blank')" style="
                                width: 100%;
                                padding: 10px;
                                background: #2196F3;
                                color: white;
                                border: none;
                                border-radius: 5px;
                                cursor: pointer;
                                font-size: 14px;
                            ">ğŸŒ åœ¨æ–°æ ‡ç­¾é¡µæ‰“å¼€å›¾ç‰‡</button>
                        </div>

                        <div style="color: #666; font-size: 12px; line-height: 1.4;">
                            ğŸ’¡ <strong>æç¤ºï¼š</strong><br>
                            â€¢ å³é”®ç‚¹å‡»ä¸Šæ–¹é“¾æ¥é€‰æ‹©"å¤åˆ¶é“¾æ¥"<br>
                            â€¢ åœ¨æ‰‹æœºä¸Šé•¿æŒ‰é“¾æ¥å¯å¤åˆ¶<br>
                            â€¢ å¤åˆ¶é“¾æ¥åç²˜è´´åˆ°æµè§ˆå™¨åœ°å€æ å³å¯ä¸‹è½½å›¾ç‰‡
                        </div>
                    </div>

                    <div style="text-align: center;">
                        <button onclick="this.closest('.modal').remove()" style="
                            background: linear-gradient(135deg, #4a90e2, #ff6b9d);
                            color: white;
                            border: none;
                            padding: 12px 30px;
                            border-radius: 8px;
                            cursor: pointer;
                            font-weight: bold;
                            margin: 0 10px;
                        ">âœ… å…³é—­</button>
                    </div>
                </div>
            `;

            // ç‚¹å‡»èƒŒæ™¯å…³é—­
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.remove();
                }
            });

            return modal;
        }

        // æ˜¾ç¤ºå›¾ç‰‡è¯¦æƒ…æ¨¡æ€æ¡†
        function showImageDetails(imageUrl, title, theme) {
            const themeName = window.appData.themesData[theme]?.name || theme;
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0,0,0,0.8);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 2000;
            `;

            modal.innerHTML = `
                <div style="
                    background: white;
                    border-radius: 15px;
                    padding: 30px;
                    max-width: 500px;
                    width: 90%;
                    position: relative;
                ">
                    <h3 style="color: #9B59B6; margin-bottom: 20px; text-align: center;">ğŸ“š å›¾ç‰‡è¯¦æƒ…</h3>

                    <div style="margin-bottom: 20px; text-align: center;">
                        <img src="${imageUrl}" alt="${title}" style="max-width: 100%; max-height: 300px; border-radius: 10px; margin-bottom: 15px;">
                        <p style="color: #333; font-weight: bold; margin: 10px 0;">${title}</p>
                        <p style="color: #666;">ä¸»é¢˜ï¼š${themeName}</p>
                        <p style="color: #999; font-size: 12px;">
                            ç”Ÿæˆæ—¶é—´ï¼š${new Date().toLocaleString('zh-CN')}
                        </p>
                    </div>

                    <div style="background: #e8f5e8; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                        <h4 style="margin: 0 0 10px 0; color: #333;">âœ… å·²è‡ªåŠ¨ä¿å­˜åˆ°å†å²è®°å½•</h4>
                        <p style="margin: 0; color: #666; font-size: 14px;">
                            è¿™å¼ å›¾ç‰‡å·²ç»ä¿å­˜åˆ°æµè§ˆå™¨çš„å†å²è®°å½•ä¸­ï¼Œä½ å¯ä»¥åœ¨"å†å²è®°å½•"é¡µé¢æŸ¥çœ‹æ‰€æœ‰ç”Ÿæˆçš„å›¾ç‰‡ã€‚
                        </p>
                    </div>

                    <div style="text-align: center;">
                        <button onclick="this.closest('.modal').remove()" style="
                            background: linear-gradient(135deg, #4a90e2, #ff6b9d);
                            color: white;
                            border: none;
                            padding: 12px 30px;
                            border-radius: 8px;
                            cursor: pointer;
                            font-weight: bold;
                        ">âœ… ç¡®å®š</button>
                    </div>
                </div>
            `;

            // ç‚¹å‡»èƒŒæ™¯å…³é—­
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.remove();
                }
            });

            return modal;
        }

        // å¤åˆ¶åˆ°å‰ªè´´æ¿åŠŸèƒ½
        function copyToClipboard(text) {
            // åˆ›å»ºä¸´æ—¶æ–‡æœ¬åŒºåŸŸ
            const textArea = document.createElement('textarea');
            textArea.value = text;
            textArea.style.position = 'fixed';
            textArea.style.left = '-9999px';
            textArea.style.top = '-9999px';
            document.body.appendChild(textArea);

            try {
                textArea.select();
                document.execCommand('copy');
                showNotification('âœ… é“¾æ¥å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');
            } catch (err) {
                // å¤‡ç”¨æ–¹æ¡ˆï¼šæç¤ºç”¨æˆ·æ‰‹åŠ¨å¤åˆ¶
                showNotification('ğŸ“‹ è¯·æ‰‹åŠ¨å¤åˆ¶é“¾æ¥');
            } finally {
                document.body.removeChild(textArea);
            }
        }

        // æ˜¾ç¤ºé€šçŸ¥
        function showNotification(message) {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: #4CAF50;
                color: white;
                padding: 15px 20px;
                border-radius: 8px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.3);
                z-index: 3000;
                font-weight: bold;
                animation: slideIn 0.3s ease-out;
            `;
            notification.textContent = message;
            document.body.appendChild(notification);

            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease-out';
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 300);
            }, 3000);
        }

        // å¤„ç†å›¾ç‰‡åŠ è½½é”™è¯¯ï¼ˆGitHub Pages å…¼å®¹ï¼‰
        function handleImageError(img) {
            img.style.display = 'none';
            const container = img.parentElement;
            const imageUrl = img.src;

            const errorDiv = document.createElement('div');
            errorDiv.style.cssText = `
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                min-height: 300px;
                background: #fff3e0;
                border: 2px dashed #ff9800;
                border-radius: 15px;
                color: #f57c00;
                padding: 20px;
                text-align: center;
                font-size: 16px;
            `;
            errorDiv.innerHTML = `
                <div style="font-size: 48px; margin-bottom: 15px;">ğŸŒ</div>
                <div style="font-size: 18px; font-weight: bold; margin-bottom: 10px; color: #e65100;">å›¾ç‰‡æ— æ³•ç›´æ¥æ˜¾ç¤º</div>
                <div style="margin-bottom: 20px; font-size: 14px; color: #666;">
                    GitHub Pages ç¯å¢ƒä¸‹çš„å®‰å…¨é™åˆ¶å¯¼è‡´å›¾ç‰‡æ— æ³•ç›´æ¥æ˜¾ç¤º<br>
                    ä½†ä½ å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼æŸ¥çœ‹å’Œä¸‹è½½å›¾ç‰‡
                </div>
                <div style="display: flex; flex-direction: column; gap: 10px; width: 100%; max-width: 300px;">
                    <button onclick="window.open('${imageUrl}', '_blank')" style="
                        background: #2196F3;
                        color: white;
                        border: none;
                        padding: 12px 20px;
                        border-radius: 8px;
                        cursor: pointer;
                        font-size: 14px;
                        font-weight: bold;
                    ">ğŸŒ åœ¨æ–°æ ‡ç­¾é¡µæŸ¥çœ‹å›¾ç‰‡</button>
                    <button onclick="copyToClipboard('${imageUrl}')" style="
                        background: #4CAF50;
                        color: white;
                        border: none;
                        padding: 12px 20px;
                        border-radius: 8px;
                        cursor: pointer;
                        font-size: 14px;
                        font-weight: bold;
                    ">ğŸ“‹ å¤åˆ¶å›¾ç‰‡é“¾æ¥</button>
                    <button onclick="showImageDownloadHelp('${imageUrl}')" style="
                        background: #9C27B0;
                        color: white;
                        border: none;
                        padding: 12px 20px;
                        border-radius: 8px;
                        cursor: pointer;
                        font-size: 14px;
                        font-weight: bold;
                    ">ğŸ’¡ ä¸‹è½½å¸®åŠ©</button>
                </div>
            `;

            container.appendChild(errorDiv);
        }

        // æ˜¾ç¤ºå›¾ç‰‡ä¸‹è½½å¸®åŠ©
        function showImageDownloadHelp(imageUrl) {
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0,0,0,0.8);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 2000;
            `;

            modal.innerHTML = `
                <div style="
                    background: white;
                    border-radius: 15px;
                    padding: 30px;
                    max-width: 500px;
                    width: 90%;
                    position: relative;
                ">
                    <h3 style="color: #9C27B0; margin-bottom: 20px; text-align: center;">ğŸ’¡ å›¾ç‰‡ä¸‹è½½æŒ‡å—</h3>

                    <div style="background: #f5f5f5; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                        <h4 style="color: #333; margin-bottom: 15px;">ğŸ“± ç”µè„‘ç”¨æˆ·ï¼š</h4>
                        <ol style="color: #666; line-height: 1.6; margin-left: 20px;">
                            <li>å³é”®ç‚¹å‡»å›¾ç‰‡é€‰æ‹©"åœ¨æ–°æ ‡ç­¾é¡µæ‰“å¼€"</li>
                            <li>åœ¨æ–°æ ‡ç­¾é¡µä¸­å³é”®ç‚¹å‡»å›¾ç‰‡</li>
                            <li>é€‰æ‹©"å›¾ç‰‡å¦å­˜ä¸º"ä¸‹è½½</li>
                        </ol>

                        <h4 style="color: #333; margin: 15px 0;">ğŸ“± æ‰‹æœºç”¨æˆ·ï¼š</h4>
                        <ol style="color: #666; line-height: 1.6; margin-left: 20px;">
                            <li>é•¿æŒ‰å›¾ç‰‡é€‰æ‹©"åœ¨æ–°æ ‡ç­¾é¡µæ‰“å¼€"</li>
                            <li>åœ¨æ–°æ ‡ç­¾é¡µä¸­é•¿æŒ‰å›¾ç‰‡</li>
                            <li>é€‰æ‹©"ä¿å­˜åˆ°ç›¸å†Œ"ä¸‹è½½</li>
                        </ol>
                    </div>

                    <div style="margin-bottom: 20px;">
                        <label style="display: block; margin-bottom: 5px; font-weight: bold; color: #555;">ğŸ”— å›¾ç‰‡é“¾æ¥ï¼š</label>
                        <div style="display: flex; gap: 10px;">
                            <input type="text" value="${imageUrl}" readonly style="
                                flex: 1;
                                padding: 10px;
                                border: 1px solid #ddd;
                                border-radius: 5px;
                                font-size: 12px;
                                font-family: monospace;
                                background: white;
                            " onclick="this.select()">
                            <button onclick="copyToClipboard('${imageUrl}')" style="
                                padding: 10px 15px;
                                background: #4CAF50;
                                color: white;
                                border: none;
                                border-radius: 5px;
                                cursor: pointer;
                            ">ğŸ“‹ å¤åˆ¶</button>
                        </div>
                    </div>

                    <div style="text-align: center;">
                        <button onclick="this.closest('.modal').remove()" style="
                            background: linear-gradient(135deg, #4a90e2, #ff6b9d);
                            color: white;
                            border: none;
                            padding: 12px 30px;
                            border-radius: 8px;
                            cursor: pointer;
                            font-weight: bold;
                        ">âœ… çŸ¥é“äº†</button>
                    </div>
                </div>
            `;

            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.remove();
                }
            });

            document.body.appendChild(modal);
        }

        // ä¸‹è½½å›¾ç‰‡å‡½æ•°ï¼ˆæœ¬åœ°ä½¿ç”¨ï¼‰
        function downloadImage(imageUrl, filename) {
            const a = document.createElement('a');
            a.href = imageUrl;
            a.download = filename;
            a.target = '_blank';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
        }

        async function handleSimpleGenerate() {
            if (window.appData.isGenerating) return;

            const title = document.getElementById('titleInput')?.value?.trim() || '';
            const apiKey = document.getElementById('apiKeyInput')?.value?.trim() || '';

            if (!window.appData.selectedTheme || !title || !apiKey) {
                showNotification('âš ï¸ è¯·å¡«å†™æ‰€æœ‰å¿…å¡«é¡¹ï¼šä¸»é¢˜ã€æ ‡é¢˜å’ŒAPIå¯†é’¥');
                return;
            }

            // ä¿å­˜ç”¨æˆ·è¾“å…¥åˆ°æœ¬åœ°å­˜å‚¨
            try {
                localStorage.setItem('literacy_user_title', title);
                localStorage.setItem('literacy_user_api_key', apiKey);
                localStorage.setItem('literacy_user_theme', window.appData.selectedTheme);
            } catch (error) {
                console.log('Failed to save user input:', error);
            }

            window.appData.isGenerating = true;
            const generateBtn = document.getElementById('generateBtn');
            if (generateBtn) {
                generateBtn.disabled = true;
                generateBtn.innerHTML = 'ğŸ¨ AIæ­£åœ¨ç»˜åˆ¶ä¸­...<span class="loading-dots"></span>';
            }

            try {
                const theme = window.appData.themesData[window.appData.selectedTheme];
                const prompt = `å„¿ç«¥è¯†å­—æµ·æŠ¥ï¼šã€Š${title}ã€‹ï¼Œä¸»é¢˜ï¼š${theme.name}ã€‚è¯æ±‡ï¼š${theme.vocabulary.core.map(item => item.chinese).join('ã€')}ã€‚é£æ ¼ï¼šå¡é€šæ’ç”»ï¼Œæ‹¼éŸ³æ ‡æ³¨ã€‚`;

                const createResponse = await fetch('https://api.kie.ai/api/v1/jobs/createTask', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${apiKey}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        model: 'nano-banana-pro',
                        input: {
                            prompt: prompt,
                            aspect_ratio: '3:4',
                            resolution: '2K',
                            output_format: 'png'
                        },
                        callBackUrl: null
                    })
                });

                const createData = await createResponse.json();
                if (!createResponse.ok || !createData.data?.taskId) {
                    throw new Error(createData.msg || 'åˆ›å»ºä»»åŠ¡å¤±è´¥');
                }

                const taskId = createData.data.taskId;

                // è½®è¯¢ç»“æœï¼ˆç®€åŒ–ç‰ˆï¼‰
                for (let i = 0; i < 30; i++) {
                    await new Promise(resolve => setTimeout(resolve, 3000));

                    const queryResponse = await fetch(`https://api.kie.ai/api/v1/jobs/recordInfo?taskId=${taskId}`, {
                        headers: { 'Authorization': `Bearer ${apiKey}` }
                    });

                    const queryData = await queryResponse.json();
                    const state = queryData.data?.state;

                    if (state === 'success') {
                        const resultJson = JSON.parse(queryData.data.resultJson);
                        const imageUrl = resultJson.resultUrls[0];
                        showSimpleResult(imageUrl, title);
                        return;
                    } else if (state === 'fail') {
                        throw new Error(`ç”Ÿæˆå¤±è´¥: ${queryData.data?.failMsg}`);
                    }
                }

                throw new Error('ç”Ÿæˆè¶…æ—¶ï¼Œè¯·é‡è¯•');

            } catch (error) {
                alert('ç”Ÿæˆå¤±è´¥: ' + error.message);
            } finally {
                window.appData.isGenerating = false;
                if (generateBtn) {
                    generateBtn.disabled = false;
                    generateBtn.textContent = 'ğŸª„ å¼€å§‹ç”Ÿæˆé­”æ³•å›¾ç‰‡';
                }
            }
        }

        function showSimpleResult(imageUrl, title) {
            const resultSection = document.getElementById('resultSection');
            const resultImage = document.getElementById('resultImage');

            if (resultSection && resultImage) {
                window.appData.currentResult = { imageUrl, title };

                // å¢å¼ºå›¾ç‰‡åŠ è½½å¤„ç†
                resultImage.onload = () => {
                    console.log('Image loaded successfully');
                    resultSection.classList.remove('hidden');
                    resultSection.scrollIntoView({ behavior: 'smooth' });
                };

                resultImage.onerror = () => {
                    console.log('Image failed to load, showing error handler');
                    handleImageError(resultImage);
                };

                resultImage.src = imageUrl;

                // è‡ªåŠ¨ä¿å­˜åˆ°å†å²è®°å½•ï¼ˆGitHub Pages å…¼å®¹ï¼‰
                try {
                    saveToHistory(imageUrl, title, window.appData.selectedTheme);
                } catch (error) {
                    console.log('Failed to save to history:', error);
                }

                // ç»‘å®šæŒ‰é’®äº‹ä»¶ï¼ˆå¢åŠ é‡è¯•æœºåˆ¶ï¼‰
                const bindButtons = () => {
                    const downloadBtn = document.getElementById('downloadBtn');
                    if (downloadBtn) {
                        downloadBtn.onclick = () => {
                            try {
                                const downloadModal = createDownloadModal(imageUrl, title);
                                document.body.appendChild(downloadModal);
                            } catch (error) {
                                console.error('Failed to create download modal:', error);
                                showNotification('âŒ ä¸‹è½½åŠŸèƒ½æš‚æ—¶ä¸å¯ç”¨ï¼Œè¯·ç¨åå†è¯•');
                            }
                        };
                    }

                    const saveHistoryBtn = document.getElementById('saveHistoryBtn');
                    if (saveHistoryBtn) {
                        saveHistoryBtn.onclick = () => {
                            try {
                                showImageDetails(imageUrl, title, window.appData.selectedTheme);
                            } catch (error) {
                                console.error('Failed to show image details:', error);
                                showNotification('âŒ å†å²è®°å½•åŠŸèƒ½æš‚æ—¶ä¸å¯ç”¨ï¼Œè¯·ç¨åå†è¯•');
                            }
                        };
                    }
                };

                // ä½¿ç”¨æ›´å¯é çš„æ–¹å¼ç»‘å®šæŒ‰é’®
                setTimeout(bindButtons, 100);

                // å¤‡ç”¨ç»‘å®šæœºåˆ¶
                setTimeout(bindButtons, 1000);
            }
        }

        // ä¿å­˜åˆ°å†å²è®°å½•å‡½æ•°
        function saveToHistory(imageUrl, title, theme) {
            try {
                const history = JSON.parse(localStorage.getItem('literacy_history') || '[]');
                const historyItem = {
                    id: Date.now().toString(),
                    title: title,
                    theme: theme,
                    themeName: window.appData.themesData[theme]?.name || theme,
                    imageUrl: imageUrl,
                    timestamp: Date.now()
                };

                history.unshift(historyItem);

                // Keep only last 50 items
                if (history.length > 50) {
                    history.splice(50);
                }

                localStorage.setItem('literacy_history', JSON.stringify(history));
                console.log('âœ… å·²è‡ªåŠ¨ä¿å­˜åˆ°å†å²è®°å½•:', title);
            } catch (error) {
                console.error('âŒ ä¿å­˜å†å²è®°å½•å¤±è´¥:', error);
            }
        }

        // ç®€å•çš„é¡µé¢åˆ‡æ¢å‡½æ•°
        window.switchPage = switchSimplePage;

        console.log('ğŸ¯ ç®€åŒ–ç‰ˆåŠ è½½å®Œæˆ');
    </script>
</body>
</html>